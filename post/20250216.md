# 拯救不小心改動的LVM(一)

> Backup is not an option, it's a nessesity.


## 前言

之前不小心看錯虛擬的磁碟使用量，莫名其妙把它的系統碟從128GB加到256GB。後來發現是看錯就想把容量縮減回去，結果一個不小心，減到了另外一個虛擬機的磁碟了。

> 這次有記得在遇到問題的時候就開始寫文章了，要不然搞完才來寫都忘記中間的細節。


## 正文

### 事發過程

| VM ID | VM Name | Disk                    | Function   | Remark             |
| ----- | ------- | ----------------------- | ---------- | ------------------ |
| 100   | Ubuntu  | KC3000/vm-100-disk-0    | boot drive | 要從256GB改回128GB |
| 101   | Debian  | local-zfs/vm-101-disk-0 | boot drive | 只是個打醬油的     |
| 101   | Debian  | KC3000/vm-101-disk-0    | data disk  | 無辜的受害者       |


1. 首先用`lvdisplay`把LVM印出來。
    ```bash
        lvdisplay
    ```

2. 接下來用`lvreduce`修改LVM的容量。 
    ***注意，這個指令會直接修改磁碟的磁區表，虛擬機裡面的資料很有可能會毀掉務必保證你有備份。***
    ```bash
        lvm lvreduce -L 128g KC3000/vm-101-disk-1
    ```
    注意這個是錯誤的指令，我應該是要調整*100*的，但不小心腦抽打成*101*了。
    雖然執行成功了，但是console印出來的容量莫名其妙是800多GB，這時候我就感到有點不對勁了。


3. 意識到不對勁的時候想說能不能直接在把它改回來，找了一下，接著就用`lvm resize`試著把容量改回來。
    ```bash
        lvm resize --extents +100PERCENT KC3000/vm-100-disk-0
    ```

4. 雖然在PVE這邊成功調整LVM的容量，但是在虛擬機裡面已經無法正常掛載這個磁碟了。
